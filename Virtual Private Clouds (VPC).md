# VPC

### what is vpc
amazon virtual private cloud lets you provision a logically isolated section of the aws cloud where you can launch aws resources in a virtual netowrk that you define.  you have complete control over your virtual networking environment, including selection of your own ip address range, creation of subnets, and configuration of route tables and network gateways. 

### creating a vpc
- when you create a VPC a route table, a network access control list and a default security group
- no subnets or internet gateways will be created

### subnets
- one subnet == one availability zone
- amazon reserve 5 ip addresses within subnet

### internet gateway
- only one internet gateway per VPC

### security groups
- security groups can't span VPCs

### route tables

### NAT Gateways
- Network Address Translation
- allows your instances in private subnets to communicate with the internet
- redundant within the AZ
- scales automatically
- no need ot patch
- not associated with security Groups
- automatically assigned a public IP address 
- just need to update Route Table
- If you have resources in multiple AZs and they share one NAT gateway, in the event that the NAT gateway's AZ is down, resources in the other AZs lose internet access.  To create an AZ-independent architecture, create a NAT gateway in each AZ and configure your routing to ensure that resources use the NATE gateway in the same AZ.

### Network Access Control List
- your VPC automatically cvomes with a default network ACL and by default it allows all outbound and inbound traffic
- you can create a custom network ACL -- by default an ACL denies all inbound and outbound traffic until you add rules
- each subnet in your VPC must be associated with a network ACL.  If you don't explicitly associate a subnet with a network ACL the subnet is automatically associated with the default network ACL
- you can block IP address uses the network ACL but not security groups
- you can associate a network ACL with multiple subnets; however, a subnet can be associated with only one network ACL at a time.  When you assoicate a netwrok ACL with a subnet the previous association is removed
- netwrk ACLs contain a numbered list of rules that is evaluated in order, starting with the lowest numbered rule
- network ACLs have separate inbound and outbound rules, and each rule can either allow or deny traffic
- network ACLs are stateless -- responses to allowed inbound traffic are subject to the rules for outbound traffic (and vice versa)

### VPC flow logs
- allows you to capture information about the IP traffic going to and from network interfaces within the VPC
- available at three levels:
    1. VPC 
    2. Subnet
    3. Network Interface Level
 - can send to CloudWatch or S3
 - you cannopt enable flow logs for VPCs that are peered with your VPC unless the peer VPC is in your account
 - you can tag flow logs
 - you cannot change flow log configurations after created
 - Not all traffic is logged: 
    - internal instances connecting to DNS server
    - traffic generated by a Windows instance for Amazon Windows license activation
    - traffic to and from 169.254.169.254 for instance metadata
    - DHCP traffic
    - traffic to reserved IP addresses for default VPC router

### Bastion host
- A NAT gateway or NAT instance is used to provide internet traffic to EC2 instances in a private subnet
- A bastion host is used to securely administer EC2 instances (using SSH or RDP)
- you cannot use a NAT Gateway as a Bastion host

### Direct Connect
- AWS Direct Connect is a cloud service solution that makes it easy to establish a dedicated network connection from your premises to AWS.  Using AWS Direct Connect, you can establish private connectivity between AWS and your datacenter, offic, or colocaiton environment, which in many cases can reduce your network costs, increase bandwith throughput, and provide a more consistent network experience than Internet-based connections
- allows you to directly connect you data center to AWS
- useful for high throughput workloads
- useful if you need stable and reliable secure connection
- steps to set up
    1. create a virtual interface in the Direct Connect console (a Public Virtual Interface)
    2. go to the VPC console and then to VPN connections -- create a Customer Gateway
    3. Create a Virtual Private Gateway
    4. Attach the Virtual Private Gateway to the desired VPC
    5. Select VPN Connections and create new VPN Connection
    6. Select the Virtual Private Gateway and the Customer Gateway
    7. Once the VPN is avilable, set up the VPN on the customer gateway or firewall

### Global Accelerator
- AWS Global Accelerator is a service in which you create accelerators to improve availability and performance of your applications for local and global users
- you are assigned two static IP address (or alternatively you can bring your own)
- you can control traffic using traffic dials -- this is done within the endpoint group
- includes the following components:
    - static IP addresses
    - accelerator
    - DNS name
    - network zone
    - listener
    - endpoint group
    - endpoint

### VPC endpoints
- a VPC endpoint enables you to privately connect your VPC to supported AWS services and VPC endpoint services powered by PrivateLink without requiring and internet gateway, NAT device, VPN connection, or AWS Direct Connect connection.  Instances in you VPC do not require public IP address to communicate with resources in the service.  Traffic between your VPC and the other service does not leave the Amazon network 
- Endpoints are virtual devices.  They are horizontally scaled, redundant, and highly available VPC components that allow communication between instances in your VPC and services without imposing availability risls or bandwith constrains on your network traffic
- two types:
    - interface endpoint
    - gateway endpoint
    
### other bits
- us-east-1a in your aws instance can be completely different than a different account -- az's are randomized


### Other Resources
[AWS VPC FAQs](https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html)
